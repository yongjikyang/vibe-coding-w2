name: ğŸ’¬ ì´ìŠˆ ìë™ ëŒ“ê¸€

on:
  issues:
    types: [opened, reopened]

jobs:
  issue-comment:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ” ì´ìŠˆ ë¶„ì„
      id: analyze
      uses: actions/github-script@v6
      with:
        script: |
          const issue = context.payload.issue;
          const title = issue.title.toLowerCase();
          const body = issue.body || '';
          const labels = issue.labels.map(label => label.name);
          
          // ì´ìŠˆ íƒ€ì… ë¶„ì„
          let issueType = 'general';
          let priority = 'medium';
          let estimatedTime = '1-2ì¼';
          
          if (title.includes('[bug]') || title.includes('bug') || title.includes('error') || title.includes('ë¬¸ì œ')) {
            issueType = 'bug';
            priority = 'high';
            estimatedTime = '0.5-1ì¼';
          } else if (title.includes('[feature]') || title.includes('ê¸°ëŠ¥') || title.includes('ì¶”ê°€')) {
            issueType = 'feature';
            priority = 'medium';
            estimatedTime = '2-5ì¼';
          } else if (title.includes('[task]') || title.includes('ì‘ì—…') || title.includes('ê°œë°œ')) {
            issueType = 'task';
            priority = 'medium';
            estimatedTime = '1-3ì¼';
          } else if (title.includes('[docs]') || title.includes('ë¬¸ì„œ') || title.includes('documentation')) {
            issueType = 'docs';
            priority = 'low';
            estimatedTime = '0.5-1ì¼';
          } else if (title.includes('[question]') || title.includes('ì§ˆë¬¸') || title.includes('ë¬¸ì˜')) {
            issueType = 'question';
            priority = 'low';
            estimatedTime = 'ì¦‰ì‹œ';
          }
          
          // ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •
          if (title.includes('urgent') || title.includes('critical') || title.includes('ê¸´ê¸‰')) {
            priority = 'critical';
          } else if (title.includes('high') || title.includes('ì¤‘ìš”')) {
            priority = 'high';
          } else if (title.includes('low') || title.includes('minor')) {
            priority = 'low';
          }
          
          // ë³µì¡ë„ ë¶„ì„
          let complexity = 'medium';
          if (body.length > 500 || title.includes('complex') || title.includes('ë³µì¡')) {
            complexity = 'high';
            estimatedTime = '3-7ì¼';
          } else if (body.length < 100 || title.includes('simple') || title.includes('ê°„ë‹¨')) {
            complexity = 'low';
            estimatedTime = '0.5-1ì¼';
          }
          
          return {
            issueType,
            priority,
            complexity,
            estimatedTime,
            hasScreenshot: body.includes('![') || body.includes('screenshot'),
            hasSteps: body.includes('1.') || body.includes('ë‹¨ê³„'),
            hasExpected: body.includes('expected') || body.includes('ì˜ˆìƒ') || body.includes('ê¸°ëŒ€')
          };

    - name: ğŸ’¬ í™˜ì˜ ëŒ“ê¸€ ì‘ì„±
      uses: actions/github-script@v6
      with:
        script: |
          const analysis = ${{ steps.analyze.outputs.result }};
          const issue = context.payload.issue;
          
          // ì´ìŠˆ íƒ€ì…ë³„ ì´ëª¨ì§€ ë° ë©”ì‹œì§€
          const typeConfig = {
            bug: { emoji: 'ğŸ›', title: 'ë²„ê·¸ ì‹ ê³ ', color: 'red' },
            feature: { emoji: 'âœ¨', title: 'ê¸°ëŠ¥ ìš”ì²­', color: 'green' },
            task: { emoji: 'ğŸ“‹', title: 'ì‘ì—… ìš”ì²­', color: 'blue' },
            docs: { emoji: 'ğŸ“š', title: 'ë¬¸ì„œ ìš”ì²­', color: 'yellow' },
            question: { emoji: 'â“', title: 'ì§ˆë¬¸', color: 'purple' },
            general: { emoji: 'ğŸ’¡', title: 'ì¼ë°˜ ì´ìŠˆ', color: 'gray' }
          };
          
          const config = typeConfig[analysis.issueType] || typeConfig.general;
          
          // ìš°ì„ ìˆœìœ„ë³„ ë©”ì‹œì§€
          const priorityConfig = {
            critical: { emoji: 'ğŸš¨', message: 'ê¸´ê¸‰ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤' },
            high: { emoji: 'âš¡', message: 'ë†’ì€ ìš°ì„ ìˆœìœ„ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤' },
            medium: { emoji: 'ğŸ“Š', message: 'ì¼ë°˜ì ì¸ ìš°ì„ ìˆœìœ„ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤' },
            low: { emoji: 'ğŸ“', message: 'ë‚®ì€ ìš°ì„ ìˆœìœ„ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤' }
          };
          
          const priorityInfo = priorityConfig[analysis.priority] || priorityConfig.medium;
          
          // ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„±
          let checklist = [];
          if (analysis.issueType === 'bug') {
            checklist = [
              'ë²„ê·¸ ì¬í˜„ ë‹¨ê³„ê°€ ëª…í™•í•œê°€ìš”?',
              'ì˜ˆìƒ ê²°ê³¼ì™€ ì‹¤ì œ ê²°ê³¼ê°€ ì„¤ëª…ë˜ì–´ ìˆë‚˜ìš”?',
              'í™˜ê²½ ì •ë³´(OS, ë¸Œë¼ìš°ì €, ë²„ì „ ë“±)ê°€ í¬í•¨ë˜ì–´ ìˆë‚˜ìš”?',
              'ìŠ¤í¬ë¦°ìƒ·ì´ë‚˜ ë¡œê·¸ê°€ ì²¨ë¶€ë˜ì–´ ìˆë‚˜ìš”?'
            ];
          } else if (analysis.issueType === 'feature') {
            checklist = [
              'ê¸°ëŠ¥ì˜ ëª©ì ê³¼ í•„ìš”ì„±ì´ ì„¤ëª…ë˜ì–´ ìˆë‚˜ìš”?',
              'êµ¬ì²´ì ì¸ ìš”êµ¬ì‚¬í•­ì´ ëª…ì‹œë˜ì–´ ìˆë‚˜ìš”?',
              'ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ê°€ í¬í•¨ë˜ì–´ ìˆë‚˜ìš”?',
              'ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ê°€ ëª…í™•í•œê°€ìš”?'
            ];
          } else {
            checklist = [
              'ìš”ì²­ ì‚¬í•­ì´ ëª…í™•í•˜ê²Œ ì„¤ëª…ë˜ì–´ ìˆë‚˜ìš”?',
              'í•„ìš”í•œ ì •ë³´ê°€ ì¶©ë¶„íˆ ì œê³µë˜ì–´ ìˆë‚˜ìš”?',
              'ì˜ˆìƒ ê²°ê³¼ê°€ ëª…ì‹œë˜ì–´ ìˆë‚˜ìš”?'
            ];
          }
          
          const comment = `
          ## ${config.emoji} ${config.title} ì ‘ìˆ˜ ì™„ë£Œ
          
          ì•ˆë…•í•˜ì„¸ìš” @${issue.user.login}ë‹˜! ì´ìŠˆë¥¼ ìƒì„±í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
          
          ### ğŸ“Š ì´ìŠˆ ë¶„ì„ ê²°ê³¼
          - **íƒ€ì…**: ${config.title}
          - **ìš°ì„ ìˆœìœ„**: ${priorityInfo.emoji} ${analysis.priority.toUpperCase()} - ${priorityInfo.message}
          - **ë³µì¡ë„**: ${analysis.complexity.toUpperCase()}
          - **ì˜ˆìƒ ì²˜ë¦¬ ì‹œê°„**: ${analysis.estimatedTime}
          
          ### âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
          ${checklist.map(item => `- [ ] ${item}`).join('\n')}
          
          ### ğŸ“‹ ì¶”ê°€ ì •ë³´
          ${analysis.hasScreenshot ? 'âœ… ìŠ¤í¬ë¦°ìƒ· í¬í•¨ë¨' : 'âŒ ìŠ¤í¬ë¦°ìƒ· ë¯¸í¬í•¨ (ê°€ëŠ¥í•˜ë©´ ì¶”ê°€í•´ì£¼ì„¸ìš”)'}
          ${analysis.hasSteps ? 'âœ… ë‹¨ê³„ë³„ ì„¤ëª… í¬í•¨ë¨' : 'âŒ ë‹¨ê³„ë³„ ì„¤ëª… ë¯¸í¬í•¨ (ì¬í˜„ ë‹¨ê³„ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”)'}
          ${analysis.hasExpected ? 'âœ… ì˜ˆìƒ ê²°ê³¼ í¬í•¨ë¨' : 'âŒ ì˜ˆìƒ ê²°ê³¼ ë¯¸í¬í•¨ (ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”)'}
          
          ### ğŸ”„ ë‹¤ìŒ ë‹¨ê³„
          1. ğŸ·ï¸ ì ì ˆí•œ ë¼ë²¨ì´ ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤
          2. ğŸ‘¥ ë‹´ë‹¹ìê°€ ìë™ìœ¼ë¡œ í• ë‹¹ë©ë‹ˆë‹¤
          3. ğŸ“ ê°œë°œíŒ€ì—ì„œ ê²€í†  í›„ ì‘ë‹µë“œë¦½ë‹ˆë‹¤
          
          ### ğŸ’¡ ë„ì›€ë§
          - ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•˜ë©´ ì–¸ì œë“  ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”
          - ì´ìŠˆ ìƒíƒœëŠ” ë¼ë²¨ì„ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
          - ê¸´ê¸‰í•œ ì‚¬í•­ì€ \`urgent\` ë¼ë²¨ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”
          
          ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™
          `;
          
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });

    - name: ğŸ¯ ì´ìŠˆ íƒ€ì…ë³„ íŠ¹ë³„ ì•ˆë‚´
      uses: actions/github-script@v6
      with:
        script: |
          const analysis = ${{ steps.analyze.outputs.result }};
          const issue = context.payload.issue;
          
          let specialComment = '';
          
          if (analysis.issueType === 'bug' && analysis.priority === 'critical') {
            specialComment = `
            ## ğŸš¨ ê¸´ê¸‰ ë²„ê·¸ ì•Œë¦¼
            
            ì´ ì´ìŠˆëŠ” ê¸´ê¸‰ ë²„ê·¸ë¡œ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤.
            
            ### ì¦‰ì‹œ í™•ì¸ ì‚¬í•­
            - [ ] í”„ë¡œë•ì…˜ í™˜ê²½ì— ì˜í–¥ì„ ì£¼ëŠ”ê°€?
            - [ ] ì‚¬ìš©ì ë°ì´í„° ì†ì‹¤ ìœ„í—˜ì´ ìˆëŠ”ê°€?
            - [ ] ë³´ì•ˆ ì·¨ì•½ì ê³¼ ê´€ë ¨ì´ ìˆëŠ”ê°€?
            - [ ] ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì„ ì•¼ê¸°í•˜ëŠ”ê°€?
            
            **ë‹´ë‹¹ìê°€ ì¦‰ì‹œ í™•ì¸í•˜ì—¬ ëŒ€ì‘í•  ì˜ˆì •ì…ë‹ˆë‹¤.**
            `;
          } else if (analysis.issueType === 'feature' && analysis.complexity === 'high') {
            specialComment = `
            ## ğŸ—ï¸ ë³µì¡í•œ ê¸°ëŠ¥ ìš”ì²­
            
            ì´ ê¸°ëŠ¥ ìš”ì²­ì€ ë³µì¡ë„ê°€ ë†’ì€ ê²ƒìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤.
            
            ### ê²€í†  ì‚¬í•­
            - ê¸°ìˆ ì  íƒ€ë‹¹ì„± ê²€í† 
            - ë¦¬ì†ŒìŠ¤ ë° ì¼ì • ê³„íš
            - ì•„í‚¤í…ì²˜ ì˜í–¥ë„ ë¶„ì„
            - ì‚¬ìš©ì ê²½í—˜ ì„¤ê³„
            
            **ìƒì„¸í•œ ê¸°íš ë° ì„¤ê³„ ë‹¨ê³„ë¥¼ ê±°ì³ ì§„í–‰ë  ì˜ˆì •ì…ë‹ˆë‹¤.**
            `;
          } else if (analysis.issueType === 'question') {
            specialComment = `
            ## â“ ì§ˆë¬¸ ë‹µë³€ ì•ˆë‚´
            
            ì§ˆë¬¸í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!
            
            ### ë¹ ë¥¸ ë‹µë³€ì„ ìœ„í•œ íŒ
            - êµ¬ì²´ì ì¸ ìƒí™©ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”
            - ì—ëŸ¬ ë©”ì‹œì§€ê°€ ìˆë‹¤ë©´ ì „ì²´ ë‚´ìš©ì„ ê³µìœ í•´ì£¼ì„¸ìš”
            - ì‹œë„í•´ë³¸ ë°©ë²•ë“¤ì„ ì•Œë ¤ì£¼ì„¸ìš”
            - ì‚¬ìš© ì¤‘ì¸ í™˜ê²½ ì •ë³´ë¥¼ í¬í•¨í•´ì£¼ì„¸ìš”
            
            **ë³´í†µ 24ì‹œê°„ ë‚´ì— ë‹µë³€ë“œë¦½ë‹ˆë‹¤.**
            `;
          }
          
          if (specialComment) {
            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: specialComment
            });
          }

    - name: ğŸ“Š ì´ìŠˆ í†µê³„ ì—…ë°ì´íŠ¸
      uses: actions/github-script@v6
      with:
        script: |
          const analysis = ${{ steps.analyze.outputs.result }};
          
          // ì´ìŠˆ í†µê³„ ëŒ“ê¸€ (ì›”ë³„ ìš”ì•½)
          const now = new Date();
          const month = now.toLocaleString('ko-KR', { month: 'long' });
          
          const statsComment = `
          ## ğŸ“ˆ ${month} ì´ìŠˆ í˜„í™©
          
          ìƒˆë¡œìš´ ì´ìŠˆê°€ ë“±ë¡ë˜ì–´ ì›”ë³„ í†µê³„ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
          
          ### ì´ë²ˆ ë‹¬ ì£¼ìš” ì§€í‘œ
          - ğŸ“ ìƒˆ ì´ìŠˆ: +1
          - ğŸ·ï¸ íƒ€ì…: ${analysis.issueType}
          - âš¡ ìš°ì„ ìˆœìœ„: ${analysis.priority}
          
          ### ğŸ’ª í•¨ê»˜ ë§Œë“¤ì–´ê°€ëŠ” í”„ë¡œì íŠ¸
          ì—¬ëŸ¬ë¶„ì˜ ì†Œì¤‘í•œ í”¼ë“œë°±ê³¼ ê¸°ì—¬ë¡œ í”„ë¡œì íŠ¸ê°€ ë°œì „í•˜ê³  ìˆìŠµë‹ˆë‹¤.
          
          ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ‰
          `;
          
          // í†µê³„ ëŒ“ê¸€ì€ ì¡°ê±´ë¶€ë¡œ ì¶”ê°€ (ë„ˆë¬´ ë§ì€ ëŒ“ê¸€ ë°©ì§€)
          const shouldAddStats = Math.random() < 0.1; // 10% í™•ë¥ ë¡œë§Œ ì¶”ê°€
          
          if (shouldAddStats) {
            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: statsComment
            });
          } 